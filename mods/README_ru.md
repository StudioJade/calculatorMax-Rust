# Руководство по разработке модов

Этот каталог содержит пользовательские функции модов для калькулятора Max. Моды позволяют определить собственные функции, используя формат `.cmfun`.

## Быстрый старт

### Формат файла

Файлы модов используют расширение `.cmfun` и написаны в формате TOML. Каждый файл мода определяет одну пользовательскую функцию.

### Базовая структура

```toml
[desc]
name = "имя_функции"

[var]
needvars = ["параметр1", "параметр2", ...]

[calc]
howto = "выражение_с_использованием_параметров"
```

### Компоненты файла

#### Раздел `[desc]`
- **name**: Имя вашей пользовательской функции. Так вы будете её вызывать в расчётах.
  - Необязательно: Если не указано, имя файла (без расширения) будет использовано как имя функции.

#### Раздел `[var]`
- **needvars**: Массив имён параметров, которые принимает ваша функция.
  - Пример: `["a", "b"]` означает, что функция принимает два параметра `a` и `b`.
  - Порядок имеет значение: они будут совпадать с аргументами в том порядке, в котором они вызываются.

#### Раздел `[calc]`
- **howto**: Выражение расчёта, использующее имена параметров.
  - Вы можете использовать все стандартные математические операции и функции.
  - Используйте имена параметров непосредственно в выражении.

## Примеры

### Пример 1: Простое сложение

**Файл: `add.cmfun`**
```toml
[desc]
name = "add"

[var]
needvars = ["a", "b"]

[calc]
howto = "a + b"
```

**Использование:**
```
add(5, 3)      → 8
add(2.5, 1.5)  → 4
```

### Пример 2: Площадь прямоугольника

**Файл: `rect_area.cmfun`**
```toml
[desc]
name = "rect_area"

[var]
needvars = ["width", "height"]

[calc]
howto = "width * height"
```

**Использование:**
```
rect_area(10, 5)   → 50
rect_area(3.5, 4)  → 14
```

### Пример 3: Квадратное уравнение (один корень)

**Файл: `quadratic.cmfun`**
```toml
[desc]
name = "quadratic"

[var]
needvars = ["a", "b", "c"]

[calc]
howto = "(-b + sqrt(b * b - 4 * a * c)) / (2 * a)"
```

**Использование:**
```
quadratic(1, -5, 6)  → 3
```

### Пример 4: Преобразование Цельсия в Фаренгейт

**Файл: `c_to_f.cmfun`**
```toml
[desc]
name = "celsius_to_fahrenheit"

[var]
needvars = ["celsius"]

[calc]
howto = "celsius * 9 / 5 + 32"
```

**Использование:**
```
celsius_to_fahrenheit(0)    → 32
celsius_to_fahrenheit(100)  → 212
```

## Поддерживаемые функции и операции

Вы можете использовать все стандартные математические функции и операции в выражении `howto`:

### Базовые операции
- Сложение: `a + b`
- Вычитание: `a - b`
- Умножение: `a * b`
- Деление: `a / b`
- Возведение в степень: `a ^ b` (не поддерживается)

### Математические функции
- `sin(x)`, `cos(x)`, `tan(x)` - Тригонометрические функции
- `asin(x)`, `acos(x)`, `atan(x)` - Обратные тригонометрические функции
- `sinh(x)`, `cosh(x)`, `tanh(x)` - Гиперболические функции
- `sqrt(x)` - Квадратный корень
- `exp(x)` - Экспоненциальная функция
- `log(x)` - Натуральный логарифм
- `log10(x)` - Логарифм по основанию 10
- `log2(x)` - Логарифм по основанию 2
- `ceil(x)` - Округление вверх
- `floor(x)` - Округление вниз
- `trunc(x)` - Усечение (удаление дробной части)
- `fabs(x)` - Абсолютное значение
- `factorial(x)` - Факториал (только для целых чисел)

### Константы
- `pi` - π (3.14159...)
- `e` - Число Эйлера (2.71828...)

## Советы

1. **Имена параметров**: Используйте описательные имена для ясности. Например, используйте `radius` вместо `r` или `height` вместо `h`.

2. **Порядок имеет значение**: Порядок параметров в `needvars` должен соответствовать порядку передачи аргументов при вызове функции.

3. **Сложные выражения**: Вы можете комбинировать несколько операций и функций.
   ```toml
   howto = "a * sin(b) + c / d"
   ```

4. **Тестирование**: Протестируйте ваши моды, вызывая их в калькуляторе Max с различными входными данными, чтобы убедиться, что они работают правильно.

5. **Обработка ошибок**: Если в выражении происходит ошибка (деление на ноль, недопустимый ввод и т.д.), калькулятор Max отобразит сообщение об ошибке.

## Организация файлов

Поместите файлы `.cmfun` непосредственно в каталог `mods/`. Они будут автоматически обнаружены и загружены при запуске калькулятора Max.

```
mods/
├── add.cmfun
├── multiply.cmfun
├── rect_area.cmfun
└── README.md (этот файл)
```

## Устранение неисправностей

- **Мод не загружается**: Проверьте, что расширение файла точно `.cmfun` и имя файла не содержит пробелов.
- **Конфликт имён модов**: Если два мода имеют одинаковое имя, будет использован последний загруженный. Убедитесь в уникальности имён.
- **Ошибки анализа**: Дважды проверьте синтаксис TOML. Убедитесь, что все скобки массива закрыты и строки в кавычках.
- **Ошибки выражения**: Проверьте, что ваши выражения используют правильный синтаксис и доступные функции.

## Продвинутые примеры

### Теорема Пифагора

```toml
[desc]
name = "pythagorean"

[var]
needvars = ["a", "b"]

[calc]
howto = "sqrt(a * a + b * b)"
```

Использование: `pythagorean(3, 4)` → 5

### Объём сферы

```toml
[desc]
name = "sphere_volume"

[var]
needvars = ["radius"]

[calc]
howto = "4 * pi * radius * radius * radius / 3"
```

Использование: `sphere_volume(5)` → 523.5987755982989

### Формула расстояния

```toml
[desc]
name = "distance"

[var]
needvars = ["x1", "y1", "x2", "y2"]

[calc]
howto = "sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1))"
```

Использование: `distance(0, 0, 3, 4)` → 5

---

Удачи в разработке модов! Если вы создадите полезные моды, поделитесь ими с сообществом!
